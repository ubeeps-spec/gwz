{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ product.name }}{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-md-5">
      {% if product.image %}
        <img id="main-image" src="{{ product.image.url }}" class="img-fluid mb-3 rounded" alt="{{ product.name }}">
      {% elif product.image_url %}
        <img id="main-image" src="{{ product.image_url }}" class="img-fluid mb-3 rounded" alt="{{ product.name }}">
      {% elif product.images.all %}
        {% with img=product.images.all.0 %}
          {% if img.image %}
            <img id="main-image" src="{{ img.image.url }}" class="img-fluid mb-3 rounded" alt="{{ product.name }}">
          {% elif img.image_url %}
            <img id="main-image" src="{{ img.image_url }}" class="img-fluid mb-3 rounded" alt="{{ product.name }}">
          {% else %}
            <img id="main-image" src="https://placehold.co/600x600?text=No+Image" class="img-fluid mb-3 rounded" alt="No Image">
          {% endif %}
        {% endwith %}
      {% else %}
        <img id="main-image" src="https://placehold.co/600x600?text=No+Image" class="img-fluid mb-3 rounded" alt="No Image">
      {% endif %}
      
      {% if product.images.all %}
        <div class="d-flex flex-wrap gap-2">
          {% for img in product.images.all %}
            {% if img.image %}
              <img src="{{ img.image.url }}" class="img-thumbnail" style="width:80px;height:80px;object-fit:cover;cursor:pointer;" onclick="document.getElementById('main-image').src='{{ img.image.url }}'">
            {% elif img.image_url %}
              <img src="{{ img.image_url }}" class="img-thumbnail" style="width:80px;height:80px;object-fit:cover;cursor:pointer;" onclick="document.getElementById('main-image').src='{{ img.image_url }}'">
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
    <div class="col-md-7 ps-md-5">
      <h2>{{ product.name }}</h2>
    <p class="mb-2">
      {% if product.discount_price %}
        <span class="text-danger fw-bold">HK${{ product.discount_price }}</span>
        <span class="text-muted text-decoration-line-through ms-2">HK${{ product.price }}</span>
      {% else %}
        <span class="fw-bold">HK${{ product.price }}</span>
      {% endif %}
    </p>
    <p class="text-muted">SKU: {{ product.sku }}</p>
    {% if product.categories.all %}
    <p class="text-muted">{% trans "Category:" %} {{ product.categories.all|join:", " }}</p>
    {% endif %}
    <p>{{ product.description|safe }}</p>
      <form method="post" action="{% url 'cart_add' product.id %}" class="mt-3">
        {% csrf_token %}
        <div class="d-flex align-items-center">
          <div class="input-group me-3" style="max-width:200px;">
            <input type="number" name="quantity" min="1" value="1" class="form-control">
            <button type="submit" class="btn btn-primary">{% trans "Add to Cart" %}</button>
          </div>
          <button type="button" class="btn btn-outline-danger wishlist-btn" data-product-id="{{ product.id }}" title="{% trans 'Add to Wishlist' %}">
             <i class="{% if is_wishlisted %}fas{% else %}far{% endif %} fa-heart"></i>
          </button>
        </div>
      </form>
  </div>
</div>
</div>
{% endblock %}
